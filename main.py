import requests
import time

TOKEN = '1617359307:PiNPnSiQ4g1h4CaQFPmyau5pI4glnNxYu3bneXet'
BASE_URL = f'https://tapi.bale.ai/bot{TOKEN}/'

WEATHER_API_KEY = '3045dd712ffe6e702e3245525ac7fa38'
WEATHER_URL = f'http://api.openweathermap.org/data/2.5/weather?q=Tehran,IR&units=metric&appid={WEATHER_API_KEY}'

BAD_WORDS = [
        "Ø´Øª",
        "Ú†Ø³",
        "Ú¯ÙˆØ²",
        "Ø§Ù†",
        "Ù„Ø¬Ù†",
        "Ú©Ø«Ø§ÙØª",
        "Ø¨ÛŒ Ø´Ø±Ù",
        "Ø¨ÛŒØ´Ø¹ÙˆØ±",
        "Ú¯ÙˆÙ‡",
        "Ú©ÙˆÙ†",
        "Ú©ÛŒØ±ÛŒ",
        "Ú©Ø³Ú©Ø´",
        "Ø¨ÛŒ Ù†Ø§Ù…ÙˆØ³",
        "Ø³Ú¯ Ù¾Ø¯Ø±",
        "Ù¾Ø¯Ø±Ø³Ú¯",
        "Ø´Ø§Ø´",
        "Ø±ÛŒØ¯Ù†",
        "Ø±ÛŒØ¯ÛŒ",
        "Ú©ÙˆÙ†ÛŒ",
        "Ø¯ÛŒÙˆØ³",
        "Ø§Ù†ÛŒ",
        "Ú¯Ù‡ÛŒ",
        "Ø¨ÛŒ Ù¾Ø¯Ø±",
        "Ù…Ø§Ø¯Ø±Ø³Ú¯",
        "Ø¨ÛŒ Ù†Ø§Ù…ÙˆØ³",
        "Ø¬Ù†Ø¯Ù‡",
        "Ú¯Ø§ÛŒØ¯ÛŒ",
        "Ú¯Ø§ÛŒØ¯Ù†",
        "Ú©ÛŒØ±",
        "Ú©ÛŒØ±ÙˆÚ©Ø³",
        "Ø¹Ù…ØªÙˆ",
        "Ø®ÙÙ‡ Ø´Ùˆ",
        "Ø®ÙÙ‡",
        "Ø®ÙÙ‡ Ø®ÙˆÙ†",
        "Ù…Ø±Ø¶ Ø¯Ø§Ø±ÛŒ",
        "Ù…Ø±Ø¶Ø¯Ø§Ø±ÛŒ",
        "Ú¯Ø±Ø¯Ù† Ø¯Ø±Ø§Ø²",
        "Ø®Ø±ÛŒ",
        "Ú¯Ø§ÙˆÛŒ",
        "Ø§Ø³Ø¨ÛŒ",
        "Ø³Ú¯ÛŒ",
        "Ø­ÛŒÙˆØ§Ù†ÛŒ",
        "Ø¯Ù‡Ù†ØªÙˆØ¨Ø¨Ù†Ø¯",
        "Ø§Ù†Ú¯Ù„",
        "Ø¢Ø´ØºØ§Ù„",
        "Ø®Ø±ÙØª",
        "Ù¾Ù¾Ù‡",
        "Ø®Ù†Ú¯",
        "Ø¯Ú©Ù„",
        "Ø¯Ù„Ù‡",
        "Ù‚Ø±ØªÛŒ",
        "Ú¯ÙˆØ²Ùˆ",
        "Ú©ÙˆÙ†Ø¯Ù‡",
        "Ú©ÙˆÙ† Ø¯Ù‡",
        "Ú¯Ø§Ú¯ÙˆÙ„",
        "Ø§Ø¨Ù„Ù‡",
        "Ú¯Ù†Ø¯Ù‡ Ú¯ÙˆØ²",
        "Ú©Ø³",
        "Ú©Ù„Ù‡ Ú©ÛŒØ±ÛŒ",
        "Ú¯Ø´Ø§Ø¯",
        "Ø¯Ø®ØªØ±Ù‚Ø±ØªÛŒ",
        "Ø®ÙˆØ§Ù‡Ø±Ø¬Ù†Ø¯Ù‡",
        "Ø®ÙˆØ§Ù‡Ø± Ø¬Ù†Ø¯Ù‡",
        "Ù…Ø§Ø¯Ø±Ø¬Ù†Ø¯Ù‡",
        "Ù…Ø§Ø¯Ø± Ø¬Ù†Ø¯Ù‡",
        "Ù„Ø®Øª",
        "Ø¨Ø®ÙˆØ±Ø´",
        "Ø¨Ù¾Ø±Ø³Ø±Ø´",
        "Ø¨Ù¾Ø±Ø±ÙˆØ´",
        "Ø¨ÛŒØ§Ø¨Ø®ÙˆØ±Ø´",
        "Ù…ÛŒØ®ÙˆØ±ÛŒØ´",
        "Ø¨Ù…Ø§Ù„",
        "Ø¯ÛŒÙˆØ³ Ø®Ø§Ù†",
        "Ø²Ø±Ù†Ø²Ù†",
        "Ø²Ù†Ø´Ùˆ",
        "Ø²Ù†ØªÙˆ",
        "Ø²Ù† Ø¬Ù†Ø¯Ù‡",
        "Ø¨Ú©Ù†Ù…Øª",
        "Ø¨Ú©Ù†",
        "Ø¨Ú©Ù† ØªÙˆØ´",
        "Ø¨Ú©Ù†Ø´",
        "Ù„Ø²",
        "Ø³Ú©Ø³",
        "Ø³Ú©Ø³ÛŒ",
        "Ø³Ø§Ú©",
        "Ø³Ø§Ú© Ø¨Ø²Ù†",
        "Ù¾ÙˆØ±Ù†",
        "Ø³Ú©Ø³ÛŒÛŒ",
        "Ú©ÙˆÙ†Ù†",
        "Ú©ÛŒØ±Ø±",
        "Ø¬Ø§Ú©Ø´",
        "Ø§Ù†ÛŒ",
        "Ø¨Ø¯Ø¨Ø®Øª",
        "Ø®Ø§ÛŒÙ‡",
        "Ø®Ø§ÛŒÙ‡ Ù…Ø§Ù„",
        "Ø®Ø§ÛŒÙ‡ Ø®ÙˆØ±",
        "Ù…Ù…Ù‡",
        "Ù…Ù…Ù‡ Ø®ÙˆØ±",
        "Ø¯Ø®ØªØ±Ø¬Ù†Ø¯Ù‡",
        "Ø®Ø§Ø±Ú©Ø³Ø¯Ù‡",
        "Ú©Ø³ Ù†Ù†Øª",
        "Ú©ÛŒØ±Ø¯ÙˆØ³",
        "Ù…Ø§Ø¯Ø±Ú©ÙˆÙ†ÛŒ",
        "Ø®Ø§Ø±Ú©Ø³Ø¯Ù‡",
        "Ø®Ø§Ø±Ú©Ø³ Ø¯Ù‡",
        "Ú©ÛŒØ±ÙˆÚ©Ø³",
        "Ú©Ø³ Ùˆ Ú©ÛŒØ±",
        "Ø²Ù†Ø§",
        "Ø²Ù†Ø§Ø²Ø§Ø¯Ù‡",
        "ÙˆÙ„Ø¯Ø²Ù†Ø§",
        "Ù…Ù„Ù†Ú¯",
        "Ø³Ø§Ø¯ÛŒØ³Ù…ÛŒ",
        "ÙØ§Ø­Ø´Ù‡",
        "Ø®Ø§Ù†Ù… Ø¬Ù†Ø¯Ù‡",
        "ÙØ§Ø­Ø´Ù‡ Ø®Ø§Ù†Ù…",
        "Ø³ÛŒÚ©ØªÛŒØ±",
        "Ø³Ø³Ú©ÛŒ",
        "Ú©Ø³ Ø®ÛŒØ³",
        "Ø­Ø´Ø±ÛŒ",
        "Ú¯Ø§ÛŒÛŒØ¯Ù†",
        "Ø¨Ú©Ø§Ø±Øª",
        "Ø¯Ø§Ù",
        "Ø¨Ú†Ù‡ Ú©ÙˆÙ†ÛŒ",
        "Ú©Ø³Ø´Ø¹Ø±",
        "Ø³Ø±Ú©ÛŒØ±",
        "Ø³ÙˆØ±Ø§Ø® Ú©ÙˆÙ†",
        "Ø­Ø´Ø±ÛŒ Ø´Ø¯Ù†",
        "Ú©Ø³ Ú©Ø±Ø¯Ù†",
        "Ú©Ø³ Ø¯Ø§Ø¯Ù†",
        "Ø¨Ú©Ù† Ø¨Ú©Ù†",
        "Ø´Ù‚ Ú©Ø±Ø¯Ù†",
        "Ú©Ø³ Ù„ÛŒØ³ÛŒØ¯Ù†",
        "Ø¢Ø¨ Ú©ÛŒØ±",
        "Ø¬Ø§Ú©Ø´",
        "Ø¬Ù„Ù‚ Ø²Ø¯Ù†",
        "Ø¬Ù†Ø¯Ù‡ Ø®Ø§Ù†Ù‡",
        "Ø´Ù‡ÙˆØªÛŒ",
        "Ø¹Ù†",
        "Ù‚Ø³",
        "Ú©Ø±Ø¯Ù†",
        "Ú©Ø±Ø¯Ù†ÛŒ",
        "Ú©Ø³ Ù„ÛŒØ³",
        "Ú©Ø³ Ú©Ø´",
        "Ú©ÙˆØ³",
        "Ú©ÛŒØ±Ù…Ú©ÛŒØ¯Ù†",
        "Ù„Ø§Ú©ÙˆÙ†ÛŒ",
        "Ù¾Ø³ØªØ§Ù†",
        "Ø¢Ù„Øª",
        "Ø¢Ù„Øª ØªÙ†Ø§Ø³Ù„ÛŒ",
        "Ù†Ø±Ú©Ø¯Ù‡",
        "Ù…Ø§Ù„ÙˆÙ†Ø¯Ù†",
        "Ø³ÙˆÙ„Ø§Ø®",
        "Ø¬Ù†Ø³ÛŒ",
        "Ø¯ÙˆØ¬Ù†Ø³Ù‡",
        "Ø³Ú¯ ØªÙˆ Ø±ÙˆØ­Øª",
        "Ø¨ÛŒ ØºÛŒØ±Øª",
        "Ù†Ø¹Ø´Ù‡",
        "Ø¨ÛŒ Ø¹ÙØª",
        "Ù…Ø§Ø¯Ø±Ù‚Ù‡ÙˆÙ‡",
        "Ù¾Ù„Ø´Øª",
        "Ù¾Ø±ÛŒÙˆØ¯",
        "Ú©Ù„Ù‡ Ú©ÛŒØ±ÛŒ",
        "Ú©ÛŒØ±Ù†Ø§Ø²",
        "Ù¾Ø´Ù…Ø§Ù…",
        "Ù„Ø®ØªÛŒ",
        "Ú©Ø³Ú©ÛŒØ±",
        "Ø¯ÙˆØ³Øª Ø¯Ø®ØªØ±",
        "Ø¯ÙˆØ³Øª Ù¾Ø³Ø±",
        "Ú©ÙˆÙ†Ø´Ùˆ",
        "Ø¯ÙˆÙ„",
        "Ø´Ù†Ú¯ÙˆÙ„",
        "Ú©ÛŒØ±Ø¯Ø±Ø§Ø²",
        "Ø¯Ø§Ù Ù†Ø§Ø²",
        "Ø³Ú©Ø³ÛŒÙ…",
        "Ú©ÙˆØµ",
        "Ø³Ø§Ú©ÙˆÙ†ÛŒ",
        "Ú©ÙˆÙ† Ú¯Ù†Ø¯Ù‡",
        "Ø³Ú©Ø³ÛŒ Ø¨Ø§Ø´",
        "Ú©Ø³Ø®Ù„",
        "ØµÛŒØºÙ‡ Ø§ÛŒ",
        "Ú¯ÙˆØ´ Ø¯Ø±Ø§Ø²",
        "Ø¯Ø±Ø§Ø²Ú¯ÙˆØ´",
        "ØªÙˆÙ„Ù‡ Ø³Ú¯",
        "Ø®Ø²",
        "Ù…Ø§Ú†",
        "Ù…Ø§Ú† Ú©Ø±Ø¯Ù†ÛŒ",
        "Ø§Ø³Ú©Ù„",
        "Ù‡ÛŒØ²",
        "Ø¨ÛŒÙ†Ø§Ù…ÙˆØ³",
        "Ø§ÙˆØ³Ú©Ù„",
        "Ø¨ÛŒ Ø¢Ø¨Ø±Ùˆ",
        "Ù„Ø§Ø´ÛŒ",
        "Ù„Ø§Ø´ Ú¯ÙˆØ´Øª",
        "Ø¨Ø§Ø³Ù†",
        "Ø¬Ú©Ø³",
        "Ø³Ú¯ ØµÙØª",
        "Ú©ØµÚ©Ø´",
        "Ù…Ø´Ø±ÙˆØ¨",
        "Ø¹Ø±Ù‚ Ø®ÙˆØ±",
        "Ø³Ú©Ø³ Ú†Øª",
        "Ø¬ÙˆÙˆÙ†",
        "Ø³Ø±Ø®ÙˆØ±",
        "Ú©Ù„ÙØª",
        "Ø­Ø´Ø±",
        "Ù„Ø§Ø³",
        "Ø²Ø§Ø±Øª",
        "Ø±Ø´ØªÛŒf",
        "ØªØ±Ú©",
        "ÙØ§Ø±Ø³",
        "Ù„Ø±",
        "Ø¹Ø±Ø¨",
        "Ø®Ø±",
        "Ú¯Ø§Ùˆ",
        "Ø§Ø³Ø¨",
        "Ú¯ÙˆØ³ÙÙ†Ø¯",
        "Ú©Ø±Ù…",
        "Ø§Ù„Ø§Ù‚",
        "Ø§Ù„Ø§Øº",
        "Ø§Ø­Ù…Ù‚",
        "Ø¨ÛŒ Ø´Ø¹ÙˆØ±",
        "Ø­Ø±ÙˆÙ…Ø²Ø§Ø¯Ù‡",
        "Ú©ÙˆÙ†ÛŒ",
        "Ú¯Ù‡",
        "Ù…Ø§Ø¯Ø± Ø¬Ù†Ø¯Ù‡",
        "Ú©Ø«",
        "Ú©Øµ",
        "Ù¾Ø³ÙˆÙ†",
        "Ø®Ø§Ø±Ú©Ø³Ù‘Ù‡",
        "Ø¯Ù‡Ù† Ú¯Ø§ÛŒÛŒØ¯Ù‡",
        "Ø¯Ù‡Ù† Ø³Ø±ÙˆÛŒØ³",
        "Ø¯Ù‡Ù† Ø³Ø±ÙˆÛŒØ³Ø§",
        "Ù¾Ø¯Ø± Ø³Ú¯",
        "Ù¾Ø¯Ø± Ø³ÙˆØ®ØªÙ‡",
        "Ù¾Ø¯Ø± ØµÙ„ÙˆØ§ØªÛŒ",
        "Ù„Ø§Ù…ØµØ¨",
        "Ø²Ù†ÛŒÚ©Ù‡",
        "Ù…Ø±ØªÛŒÚ©Ù‡",
        "Ù…Ø±Ø¯ÛŒÚ©Ù‡",
        "Ø¨ÛŒ Ø®Ø§ÛŒÙ‡",
        "Ø¹ÙˆØ¶ÛŒ",
        "Ø§Ø³Ú¯Ù„",
        "Ø§ÙˆØ³Ú©Ù„",
        "Ø§ÙˆØ³Ú¯Ù„",
        "Ø§ÙˆØµÚ¯Ù„",
        "Ø§ÙˆØµÚ©Ù„",
        "Ø¯ÛŒÙˆØ«",
        "Ø¯ÛŒÙˆØµ",
        "Ù‚Ø±Ù…ØµØ§Ù‚",
        "Ù‚Ø±Ù…Ø³Ø§Ù‚",
        "ØºØ±Ù…Ø³Ø§Ù‚",
        "ØºØ±Ù…ØµØ§Ù‚",
        "ÙÛŒÙ„Ù… Ø³ÙˆÙ¾Ø±",
        "Ú†Ø§Ù‚Ø§Ù„",
        "Ú†Ø§ØºØ§Ù„",
        "Ú†Ø³ Ø®ÙˆØ±",
        "Ú©Ø³ Ø®ÙˆØ±",
        "Ú©Ø³ Ø®Ù„",
        "Ú©ÙˆØ³ Ø®ÙˆØ±",
        "Ú©ÙˆØ³ Ø®Ù„",
        "Ú©Øµ Ù„ÛŒØ³",
        "Ú©Ø« Ù„ÛŒØ³",
        "Ú©Ø³ Ù„ÛŒØ³",
        "Ú©ÙˆØµ Ù„ÛŒØ³",
        "Ú©ÙˆØ« Ù„ÛŒØ³",
        "Ú©ÙˆØ³ Ù„ÛŒØ³"
]

WEATHER_DESCRIPTIONS = {
    "clear sky": "Ø¢Ø³Ù…Ø§Ù† ØµØ§Ù",
    "few clouds": "Ú©Ù…ÛŒ Ø§Ø¨Ø±ÛŒ",
    "scattered clouds": "Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡",
    "broken clouds": "Ø§Ø¨Ø±Ù‡Ø§ÛŒ Ø´Ú©Ø³ØªÙ‡",
    "shower rain": "Ø¨Ø§Ø±Ø§Ù† Ø±Ú¯Ø¨Ø§Ø±ÛŒ",
    "rain": "Ø¨Ø§Ø±Ø§Ù†",
    "thunderstorm": "Ø±Ø¹Ø¯ Ùˆ Ø¨Ø±Ù‚",
    "snow": "Ø¨Ø±Ù",
    "mist": "Ù…Ù‡"
}

def get_updates(offset=None):
    url = BASE_URL + 'getUpdates'
    params = {'offset': offset, 'timeout': 100} if offset else {'timeout': 100}
    response = requests.get(url, params=params)
    return response.json()

def send_message(chat_id, text, reply_to_message_id=None):
    url = BASE_URL + 'sendMessage'
    payload = {'chat_id': chat_id, 'text': text, 'reply_to_message_id': reply_to_message_id}
    requests.post(url, json=payload)

def check_message_for_bad_words(message):
    text = message.get('text', '').lower()
    if any(bad_word in text for bad_word in BAD_WORDS):
        return True
    return False

def translate_weather_description(description):
    return WEATHER_DESCRIPTIONS.get(description, description)

def get_weather():
    response = requests.get(WEATHER_URL)
    data = response.json()
    if response.status_code == 200:
        temp = data['main']['temp']
        weather_description = data['weather'][0]['description']
        translated_description = translate_weather_description(weather_description)
        weather_message = f"Ø¯Ù…Ø§ÛŒ ØªÙ‡Ø±Ø§Ù†: *{temp}Â°C*\nÙˆØ¶Ø¹ÛŒØª Ù‡ÙˆØ§: *{translated_description}*"
    else:
        weather_message = "Ù…Ø´Ú©Ù„ÛŒ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙˆØ¶Ø¹ÛŒØª Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ Ø¨Ù‡ ÙˆØ¬ÙˆØ¯ Ø¢Ù…Ø¯."
    return weather_message

def main():
    offset = None
    while True:
        updates = get_updates(offset)
        for update in updates.get('result', []):
            message = update.get('message')
            if message:
                chat_id = message['chat']['id']
                user_name = message['from']['first_name']
                message_id = message['message_id']
                text = message.get('text', '').lower()
                if check_message_for_bad_words(message):
                    warning_message = f"{user_name} ÙØ­Ø´ Ù†Ø¯Ù‡ Ú©ØµÚ©Ø´ ğŸ—¿"
                    send_message(chat_id, warning_message, reply_to_message_id=message_id)
                elif text == "Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ":
                    weather_message = get_weather()
                    send_message(chat_id, weather_message, reply_to_message_id=message_id)
                elif "ğŸ˜‚" in text:
                    emoji_response = "Ø®ÙˆØ¨ Ù…ÛŒØ®Ù†Ø¯ÛŒ ğŸ—¿"
                    send_message(chat_id, emoji_response, reply_to_message_id=message_id)
            offset = update['update_id'] + 1
        time.sleep(1)

if __name__ == '__main__':
    main()